{"version":3,"sources":["ui.js"],"names":[],"mappings":"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","file":"ui.js","sourcesContent":["// main.js\n\n/* global $ Saturn Highcharts Handlebars Analyst Save FileReader */\n\n$(function () {\n\n  let render = function (data) {\n    console.log('rendering')\n    $('#analysis').addClass('hidden')\n\n    $('#data').empty()\n\n    if (data.length > 0) {\n      $('#analysis').removeClass('hidden')\n\n      let analysis = analyst.analyze(data)\n\n      let chartData = []\n      let hueIndex = 0\n      for (let entry of analysis.entries()) {\n        let hue = (hueIndex / analysis.tags.length) * 360\n        entry.color = 'hsl(' + hue + ', 100%, 87.5%)'\n        hueIndex += 1\n\n        let html = Handlebars.templates.row(entry)\n        $('#data').append(html)\n\n        chartData.push({\n          y: entry.count,\n          name: entry.tag,\n          color: entry.color\n        })\n      }\n      chart(chartData, $('#chart'))\n    }\n  }\n\n  let chart = function (data, container) {\n    container.highcharts({\n      chart: {\n        plotBackgroundColor: null,\n        plotBorderWidth: null,\n        plotShadow: false,\n        type: 'pie'\n      },\n      title: {\n        text: 'What you\\'ve been doing'\n      },\n      tooltip: {\n        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'\n      },\n      plotOptions: {\n        pie: {\n          allowPointSelect: true,\n          cursor: 'pointer',\n          dataLabels: {\n            enabled: true,\n            format: '<b>{point.name}</b>: {point.percentage:.1f} %',\n            style: {\n              color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'\n            }\n          }\n        }\n      },\n      series: [{\n        name: 'Tags',\n        colorByPoint: true,\n        data: data\n      }]\n    })\n  }\n\n  // play a sound\n  let snd = false\n  let ping = function () {\n    console.log('pinging')\n    snd = snd || new window.Audio('ui/ping.mp3')\n    snd.play()\n  }\n\n  // export data\n  let exportData = function () {\n    console.log('exporting')\n    Save().download_object(saturn.data(), 'saturn-tags.json')\n  }\n\n  // show browser notification\n  let notify = function (text) {\n    console.log('notify: ', text)\n    // Let's check if the browser supports notifications\n    if (!('Notification' in window)) {\n      return false\n\n    // Let's check whether notification permissions have already been granted\n    } else if (window.Notification.permission === 'granted') {\n      // If it's okay let's create a notification\n      return new window.Notification(text)\n\n    // Otherwise, we need to ask the user for permission\n    } else if (window.Notification.permission !== 'denied') {\n      window.Notification.requestPermission(function (permission) {\n        // If the user accepts, let's create a notification\n        if (permission === 'granted') {\n          return new window.Notification(text)\n        }\n      })\n    }\n  }\n\n  // show form\n  let ask = function (partial) {\n    ping()\n    notify('What are you doing?')\n\n    let html = Handlebars.templates.form(partial)\n    $('#forms').prepend(html)\n\n    if (saturn.data().length > 0) {\n      $('.tag').typeahead({\n        source: analyst.analyze(saturn.data()).tags\n      })\n    }\n\n    listen(partial)\n  }\n\n  // handle new-data form\n  let listen = function (partial) {\n    let form = $('#' + partial.id)\n\n    form.submit(function (event) {\n      event.preventDefault()\n\n      // get tag\n      let tag = form.find('.tag').val()\n\n      // validate tag\n      if (tag.length === 0) {\n        form.addClass('has-error')\n        return false\n      }\n\n      // complete datum\n      partial.tag = tag\n\n      // send to saturn\n      saturn.add(partial)\n\n      // remove form\n      $('#' + partial.id).remove()\n    })\n  }\n\n  // read a file\n  let importFile = function (e) {\n    var file = e.target.files[0]\n    if (!file) {\n      return\n    }\n    var reader = new FileReader()\n    reader.onload = function (e) {\n      var contents = e.target.result\n      saturn.import(JSON.parse(contents))\n    }\n    reader.readAsText(file)\n\n  }\n\n  let saturn = new Saturn()\n  let analyst = new Analyst()\n\n  saturn.subscribe(render)\n\n  $('#import').on('change', importFile)\n  $('#clear').click(saturn.clear)\n  $('#exportButton').click(exportData)\n\n  saturn.start({\n    prompt: ask,\n    minutes: 40,\n    askFirst: true\n  })\n\n  render(saturn.data())\n})\n"],"sourceRoot":"/source/"}