{"version":3,"sources":["saturn.js"],"names":[],"mappings":"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","file":"saturn.js","sourcesContent":["// main.js\n\n/* global PoissonProcess JSON */\n\nwindow.Saturn = function () {\n\n  let API = {}\n\n  let params = null\n\n  // start process\n  API.start = function (p) {\n    params = p\n    if (params.askFirst) { ask() }\n    let poisson = PoissonProcess.create(params.minutes * 60 * 1000, ask)\n    poisson.start()\n    console.log('starting. asking every ' + params.minutes + ' minutes')\n  }\n\n  // clear data\n  API.clear = function () {\n    console.log('clearing')\n    window.localStorage.removeItem('tagTime')\n    publish()\n  }\n\n  // get data\n  API.data = function () {\n    let string = window.localStorage.getItem('tagTime')\n    let data = []\n    if (string !== null && string.length > 0) {\n      let parsed = JSON.parse(string)\n      if (Array.isArray(parsed)) {\n        data = parsed\n      }\n    }\n    return data\n  }\n\n  // import data\n  API.import = function (data) {\n    for (let datum of data) {\n      API.add(datum)\n    }\n  }\n\n  // add datapoint\n  API.add = function (datum) {\n    if (validate(datum)) {\n      pushDatum(datum)\n    } else {\n      console.log('datapoint exists')\n    }\n  }\n\n  // validate datapoint\n  let validate = function (datum) {\n    if (datum.tag.length === 0 ||\n      datum.id.length === 0 ||\n      datum.timestamp.length === 0 ||\n      datum_exists(datum)\n    ) {\n      return false\n    } else {\n      return true\n    }\n  }\n\n  // check if a datapoint is in the data\n  let datum_exists = function (datum) {\n    for (let entry of API.data()) {\n      if (datum.id === entry.id) {\n        return true\n      }\n    }\n    return false\n  }\n\n  // push datum to localStorage\n  let pushDatum = function (datum) {\n    let data = API.data()\n    data.push(datum)\n    let string = JSON.stringify(data)\n    window.localStorage.setItem('tagTime', string)\n    publish()\n  }\n\n  // new data pubsub\n  let subscribers = []\n  // subscribe to new data events\n  API.subscribe = function (callback) {\n    subscribers.push(callback)\n  }\n  let publish = function () {\n    for (let callback of subscribers) {\n      callback(API.data())\n    }\n  }\n\n  // from http://stackoverflow.com/a/2117523/3943439\n  let uuid = function () {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n      let r = Math.random() * 16 | 0\n      let v = c === 'x' ? r : (r & 0x3 | 0x8)\n      return v.toString(16)\n    })\n  }\n\n  // display prompt\n  let ask = function () {\n    let partial = {\n      interval: params.minutes,\n      timestamp: new Date(),\n      id: uuid()\n    }\n    params.prompt(partial)\n  }\n\n  return API\n}\n"],"sourceRoot":"/source/"}